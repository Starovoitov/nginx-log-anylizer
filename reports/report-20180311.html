<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>rbui log analysis report</title>
  <meta name="description" content="rbui log analysis report">
  <style type="text/css">
    html, body {
      background-color: black;
    }
    th {
      text-align: center;
      color: silver;
      font-style: bold;
      padding: 5px;
      cursor: pointer;
    }
    table {
      width: auto;
      border-collapse: collapse;
      margin: 1%;
      color: silver;
    }
    td {
      text-align: right;
      font-size: 1.1em;
      padding: 5px;
    }
    .report-table-body-cell-url {
      text-align: left;
      width: 20%;
    }
    .clipped {
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow:hidden !important;
      max-width: 700px;
      word-wrap: break-word;
      display:inline-block;
    }
    .url {
      cursor: pointer;
      color: #729FCF;
    }
    .alert {
      color: red;
    }
  </style>
</head>

<body>
  <table border="1" class="report-table">
  <thead>
    <tr class="report-table-header-row">
    </tr>
  </thead>
  <tbody class="report-table-body">
  </tbody>

  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript" src="jquery.tablesorter.min.js"></script> 
  <script type="text/javascript">
  !function($) {
    var table = [{'count': 2767, 'time_avg': 59.437218286953431, 'time_max': 75.129000000000005, 'time_sum': 164462.78300000014, 'url': '/api/v2/internal/html5/phantomjs/queue/?wait=1m', 'time_med': 60.073, 'time_perc': 0.085322229625712329, 'count_perc': 0.0010586581555703325}, {'count': 1414, 'time_avg': 60.166482319660474, 'time_max': 71.290999999999997, 'time_sum': 85075.405999999915, 'url': '/api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=1', 'time_med': 60.122999999999998, 'time_perc': 0.044136571167184314, 'count_perc': 0.00054099842138650165}, {'count': 1410, 'time_avg': 60.117369503546072, 'time_max': 65.126000000000005, 'time_sum': 84765.490999999965, 'url': '/api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=5', 'time_med': 60.124000000000002, 'time_perc': 0.04397578926679261, 'count_perc': 0.00053946801566829379}, {'count': 1409, 'time_avg': 60.121564939673469, 'time_max': 69.090999999999994, 'time_sum': 84711.284999999916, 'url': '/api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=2', 'time_med': 60.125, 'time_perc': 0.043947667544085925, 'count_perc': 0.00053908541423874174}, {'count': 1393, 'time_avg': 60.115661162957672, 'time_max': 65.123999999999995, 'time_sum': 83741.116000000038, 'url': '/api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=3', 'time_med': 60.124499999999998, 'time_perc': 0.043444350132792103, 'count_perc': 0.0005329637913659101}, {'count': 1392, 'time_avg': 60.073831896551674, 'time_max': 71.293999999999997, 'time_sum': 83622.773999999932, 'url': '/api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=4', 'time_med': 60.124000000000002, 'time_perc': 0.043382955067512351, 'count_perc': 0.00053258118993635805}, {'count': 1320, 'time_avg': 16.620220454545461, 'time_max': 24.053000000000001, 'time_sum': 21938.69100000001, 'url': '/export/ivi/200010-impression.csv', 'time_med': 16.483000000000001, 'time_perc': 0.011381651198189608, 'count_perc': 0.00050503388700861543}, {'count': 699, 'time_avg': 13.889872675250349, 'time_max': 28.202999999999999, 'time_sum': 9709.0209999999934, 'url': '/campaigns/7854376/banners/?', 'time_med': 13.4815, 'time_perc': 0.005036977388391037, 'count_perc': 0.000267438399256835}, {'count': 699, 'time_avg': 11.457237482117309, 'time_max': 25.643000000000001, 'time_sum': 8008.6089999999995, 'url': '/campaigns/7854473/banners/?', 'time_med': 11.243, 'time_perc': 0.0041548146250239828, 'count_perc': 0.000267438399256835}, {'count': 48, 'time_avg': 113.17025000000001, 'time_max': 250.059, 'time_sum': 5432.1720000000005, 'url': '//api/1/banners/', 'time_med': 223.40100000000001, 'time_perc': 0.0028181757495272632, 'count_perc': 1.8364868618495106e-05}, {'count': 236, 'time_avg': 22.634504237288134, 'time_max': 36.195, 'time_sum': 5341.7429999999995, 'url': '/api/v2/internal/slots', 'time_med': 23.6555, 'time_perc': 0.0027712617683694494, 'count_perc': 9.02939373742676e-05}, {'count': 47, 'time_avg': 102.85331914893615, 'time_max': 128.52000000000001, 'time_sum': 4834.1059999999989, 'url': '/api/v2/slot/2406/groups', 'time_med': 102.41, 'time_perc': 0.0025079029713794472, 'count_perc': 1.7982267188943125e-05}, {'count': 19764, 'time_avg': 0.23726649463671723, 'time_max': 24.869, 'time_sum': 4689.3350000000792, 'url': '/api/1/photogenic_banners/post/', 'time_med': 0.13500000000000001, 'time_perc': 0.0024327967115933828, 'count_perc': 0.0075617346536653602}, {'count': 700, 'time_avg': 6.3945957142857166, 'time_max': 26.286999999999999, 'time_sum': 4476.2170000000015, 'url': '/campaigns/7854362/banners/?', 'time_med': 6.1875, 'time_perc': 0.0023222324696312415, 'count_perc': 0.00026782100068638694}, {'count': 699, 'time_avg': 6.3762303290414915, 'time_max': 17.419, 'time_sum': 4456.9850000000024, 'url': '/campaigns/7876636/banners/?', 'time_med': 6.1870000000000003, 'time_perc': 0.0023122550322424943, 'count_perc': 0.000267438399256835}, {'count': 1294, 'time_avg': 3.3162782071097316, 'time_max': 533.74000000000001, 'time_sum': 4291.2639999999928, 'url': '/campaigns/', 'time_med': 1.4620000000000002, 'time_perc': 0.0022262800477634618, 'count_perc': 0.00049508624984026387}, {'count': 700, 'time_avg': 5.6001242857142923, 'time_max': 22.853999999999999, 'time_sum': 3920.0870000000045, 'url': '/campaigns/7854359/banners/?', 'time_med': 5.4459999999999997, 'time_perc': 0.0020337158174367621, 'count_perc': 0.00026782100068638694}, {'count': 699, 'time_avg': 5.5053919885550711, 'time_max': 44.889000000000003, 'time_sum': 3848.2689999999948, 'url': '/campaigns/7876633/banners/?', 'time_med': 5.3410000000000002, 'time_perc': 0.0019964571028784645, 'count_perc': 0.000267438399256835}, {'count': 56, 'time_avg': 67.622982142857126, 'time_max': 81.628, 'time_sum': 3786.8869999999993, 'url': '/api/1/banners/?campaign=1392872', 'time_med': 67.381499999999988, 'time_perc': 0.0019646125177185197, 'count_perc': 2.1425680054910956e-05}, {'count': 56, 'time_avg': 67.456249999999983, 'time_max': 82.477000000000004, 'time_sum': 3777.5499999999988, 'url': '/api/1/banners/?campaign=1200302', 'time_med': 66.742500000000007, 'time_perc': 0.0019597685424222037, 'count_perc': 2.1425680054910956e-05}];
    var reportDates;
    var columns = new Array();
    var lastRow = 150;
    var $table = $(".report-table-body");
    var $header = $(".report-table-header-row");
    var $selector = $(".report-date-selector");

    $(document).ready(function() {
      $(window).bind("scroll", bindScroll);
        var row = table[0];
        for (k in row) {
          columns.push(k);
        }
        columns = columns.sort();
        columns = columns.slice(columns.length -1, columns.length).concat(columns.slice(0, columns.length -1));
        drawColumns();
        drawRows(table.slice(0, lastRow));
        $(".report-table").tablesorter(); 
    });

    function drawColumns() {
      for (var i = 0; i < columns.length; i++) {
        var $th = $("<th></th>").text(columns[i])
                                .addClass("report-table-header-cell")
        $header.append($th);
      }
    }

    function drawRows(rows) {
      for (var i = 0; i < rows.length; i++) {
        var row = rows[i];
        var $row = $("<tr></tr>").addClass("report-table-body-row");
        for (var j = 0; j < columns.length; j++) {
          var columnName = columns[j];
          var $cell = $("<td></td>").addClass("report-table-body-cell");
          if (columnName == "url") {
            var url = "https://rb.mail.ru" + row[columnName];
            var $link = $("<a></a>").attr("href", url)
                                    .attr("title", url)
                                    .attr("target", "_blank")
                                    .addClass("clipped")
                                    .addClass("url")
                                    .text(row[columnName]);
            $cell.addClass("report-table-body-cell-url");
            $cell.append($link);
          }
          else {
            $cell.text(row[columnName]);
            if (columnName == "time_avg" && row[columnName] > 0.9) {
              $cell.addClass("alert");
            }
          }
          $row.append($cell);
        }
        $table.append($row);
      }
      $(".report-table").trigger("update"); 
    }

    function bindScroll() {
      if($(window).scrollTop() == $(document).height() - $(window).height()) {
        if (lastRow < 1000) {
          drawRows(table.slice(lastRow, lastRow + 50));
          lastRow += 50;
        }
      }
    }

  }(window.jQuery)
  </script>
</body>
</html>
